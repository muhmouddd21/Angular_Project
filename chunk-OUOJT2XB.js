import{a as D,c as j,f as B,i as R,s as U}from"./chunk-KWJHN24A.js";import{a as G}from"./chunk-6JEOAQEH.js";import{a as $}from"./chunk-QM6DZXPC.js";import{a as _,b as E}from"./chunk-5GY5W4OM.js";import{b as Q,c as A,d as I,f as F,j as T}from"./chunk-SLN674KU.js";import{$a as O,Ja as f,La as l,Ma as y,Oa as a,P as S,Pa as o,Ta as C,Ua as h,V as q,Va as u,Xa as c,Ya as k,Za as v,_ as z,_a as w,ab as M,bb as P,db as V,ga as b,ha as x,va as s,wa as m}from"./chunk-RI2LG5KK.js";var N=(()=>{class i{constructor(){this.http=q(F)}patchRequest(e,t,n){return this.http.patch(e,t,n)}putRequest(e,t,n){return this.http.put(e,t,n)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function J(i,d){if(i&1){let e=C();a(0,"li")(1,"label")(2,"input",15),P("ngModelChange",function(n){b(e);let r=u(2);return M(r.selectedOption,n)||(r.selectedOption=n),x(n)}),o(),c(3),o()()}if(i&2){let e=d.$implicit,t=u().index,n=u();s(2),l("value",e),O("ngModel",n.selectedOption),l("disabled",n.answerStatus[t]!==null),s(),v(" ",e," ")}}function Y(i,d){i&1&&(a(0,"div",16),c(1," \u2713 Correct! "),o())}function K(i,d){if(i&1&&(a(0,"div",17),c(1," \u2717 Incorrect! Correct Answer: "),a(2,"strong"),c(3),o()()),i&2){let e=u().$implicit;s(3),k(e.correctAnswer)}}function X(i,d){if(i&1){let e=C();a(0,"div",7)(1,"div",8)(2,"p",9),c(3),o(),a(4,"ul",10),f(5,J,4,4,"li",11),o(),a(6,"button",12),h("click",function(){let n=b(e),r=n.$implicit,g=n.index,p=u();return x(p.checkAnswer(g,r,r.correctAnswer))}),c(7," Check Answer "),o(),f(8,Y,2,0,"div",13)(9,K,4,1,"div",14),o()()}if(i&2){let e=d.$implicit,t=d.index,n=u();y("correct",n.answerStatus[t]==="correct")("incorrect",n.answerStatus[t]==="incorrect"),s(3),w("",t+1,". ",e.question,""),s(2),l("ngForOf",e.options),s(),l("disabled",n.answerStatus[t]!==null),s(2),l("ngIf",n.answerStatus[t]==="correct"),s(),l("ngIf",n.answerStatus[t]==="incorrect")}}var de=(()=>{class i{constructor(e,t,n,r,g){this.router=e,this.quizState=t,this.sendData=n,this.getData=r,this.authServive=g,this.showErrorAlert=!1,this.answerStatus=[],this.wrongAnswer=[],this.grade=0,this.quizSaved=!1}ngOnInit(){this.questionsForm=this.quizState.getQuiz();let e=this.questionsForm.questions.length;this.answerStatus=new Array(e).fill(null)}checkAnswer(e,t,n){this.selectedOption!==n?(this.wrongAnswer.push(t),this.answerStatus[e]="incorrect"):(this.answerStatus[e]="correct",this.grade++)}isQuizCompleted(){return this.answerStatus.every(e=>e!==null)}showAlert(){this.showErrorAlert=!0}goHome(){this.quizState.clearQuiz(),this.router.navigateByUrl("/")}navigateToGrade(){this.router.navigateByUrl("/questions/grade")}isQuizSaved(){return this.quizSaved}saveQuiz(){if(!this.isQuizCompleted()){alert("Please answer all questions.");return}this.getData.getRequest(_.concat(`${this.authServive.Uid}`),{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authServive.idtoken}`}}).subscribe({next:e=>{try{let t;if(e instanceof ArrayBuffer){let H=new TextDecoder().decode(e);t=JSON.parse(H)}else t=e;let n=this.buildQuizPayload(),r=[];t?.fields?.quizzes?.arrayValue?.values&&(r=t.fields.quizzes.arrayValue.values),r.push(n);let g={fields:{quizzes:{arrayValue:{values:r}}}};this.sendData.patchRequest(_.concat(`${this.authServive.Uid}`),g,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authServive.idtoken}`}}).subscribe({next:p=>{console.log("Quiz added:",p)},error:p=>{console.error("Save error:",p),this.showAlert(),this.router.navigate(["login"])},complete:()=>{this.quizSaved=!0,alert("Quiz saved successfully"),this.quizState.clearQuiz(),this.router.navigateByUrl("/")}})}catch(t){console.error("Parse error:",t),this.showAlert(),this.router.navigate(["login"])}},error:e=>{console.error("GET failed, creating new:",e);let t={fields:{quizzes:{arrayValue:{values:[this.buildQuizPayload()]}}}};this.sendData.patchRequest(_.concat(`${this.authServive.Uid}`),t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authServive.idtoken}`}}).subscribe({next:n=>{console.log("Created new quiz doc:",n)},error:n=>{console.error("Create doc error:",n),this.showAlert(),this.router.navigate(["login"])},complete:()=>{this.quizSaved=!0,alert("Quiz saved successfully"),this.quizState.clearQuiz(),this.router.navigateByUrl("/")}})}})}buildQuizPayload(){return{mapValue:{fields:{topic:{stringValue:this.questionsForm.topic},level:{stringValue:this.questionsForm.level},quizTime:{timestampValue:new Date().toISOString()},questions:{arrayValue:{values:this.questionsForm.questions.map(e=>({mapValue:{fields:{id:{stringValue:e.id},question:{stringValue:e.question},options:{arrayValue:{values:e.options.map(t=>({stringValue:t}))}},correctAnswer:{stringValue:e.correctAnswer}}}}))}},wrongAnswers:{arrayValue:{values:this.wrongAnswer.map(e=>({mapValue:{fields:{id:{stringValue:e.id},question:{stringValue:e.question},options:{arrayValue:{values:e.options.map(t=>({stringValue:t}))}},correctAnswer:{stringValue:e.correctAnswer}}}}))}}}}}}static{this.\u0275fac=function(t){return new(t||i)(m(T),m($),m(N),m(G),m(E))}}static{this.\u0275cmp=z({type:i,selectors:[["app-questions"]],standalone:!0,features:[V],decls:14,vars:5,consts:[[1,"quiz-container"],[1,"level"],["class","question-card",3,"correct","incorrect",4,"ngFor","ngForOf"],[1,"quiz-footer"],[1,"grade"],[1,"action-buttons"],[1,"check-btn",3,"click"],[1,"question-card"],[1,"question-content"],[1,"question-text"],[1,"options-list"],[4,"ngFor","ngForOf"],[1,"check-btn",3,"click","disabled"],["class","feedback correct-feedback",4,"ngIf"],["class","feedback incorrect-feedback",4,"ngIf"],["type","radio",3,"ngModelChange","value","ngModel","disabled"],[1,"feedback","correct-feedback"],[1,"feedback","incorrect-feedback"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"h1"),c(2),o(),a(3,"h2",1),c(4),o(),f(5,X,10,10,"div",2),a(6,"div",3)(7,"p",4),c(8),o(),a(9,"div",5)(10,"button",6),h("click",function(){return n.saveQuiz()}),c(11,"Save Quiz"),o(),a(12,"button",6),h("click",function(){return n.goHome()}),c(13,"Back to Home"),o()()()()),t&2&&(s(2),v("Topic: ",n.questionsForm.topic,""),s(2),v("Level: ",n.questionsForm.level,""),s(),l("ngForOf",n.questionsForm.questions),s(3),w(" Your Grade: ",n.grade," / ",n.questionsForm.questions.length," "))},dependencies:[I,Q,A,U,D,R,j,B],styles:[".quiz-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#333}h1[_ngcontent-%COMP%]{font-size:24px;margin-bottom:5px;color:#2c3e50}.level[_ngcontent-%COMP%]{font-size:18px;color:#7f8c8d;margin-bottom:30px;font-weight:400}.question-card[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:4px;margin-bottom:20px;background:#fff}.question-card.correct[_ngcontent-%COMP%]{border-left:4px solid #2ecc71}.question-card.incorrect[_ngcontent-%COMP%]{border-left:4px solid #e74c3c}.question-content[_ngcontent-%COMP%]{padding:20px}.question-text[_ngcontent-%COMP%]{font-weight:600;margin-bottom:15px;font-size:16px}.options-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin-bottom:20px}.options-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 0;border-bottom:1px solid #eee}.options-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.options-list[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.options-list[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:10px}.check-btn[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color .3s}.check-btn[_ngcontent-%COMP%]:hover{background-color:#2980b9}.check-btn[_ngcontent-%COMP%]:disabled{background-color:#95a5a6;cursor:not-allowed}.feedback[_ngcontent-%COMP%]{margin-top:15px;padding:10px;border-radius:4px;font-size:14px}.correct-feedback[_ngcontent-%COMP%]{background-color:#e8f8f0;color:#27ae60}.incorrect-feedback[_ngcontent-%COMP%]{background-color:#fdedec;color:#c0392b}.grade-btn[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 24px;font-size:18px;border:none;border-radius:8px;transition:background-color .3s}.grade-btn[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.grade-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1rem;flex-wrap:wrap}.action-buttons[_ngcontent-%COMP%]   .check-btn[_ngcontent-%COMP%]{margin:0 .5rem}"]})}}return i})();export{de as QuestionsComponent};
